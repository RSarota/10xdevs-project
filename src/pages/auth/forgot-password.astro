---
import AuthLayout from "../../layouts/AuthLayout.astro";
import { ForgotPasswordForm } from "../../components/auth/ForgotPasswordForm";
import { Card, CardContent, Stack, Title1, Body } from "../../components/apple-hig";
import { KeyRound, AlertCircle } from "lucide-react";

export const prerender = false;

// Check for error messages from confirmation
const error = Astro.url.searchParams.get("error");
const errorMessage = Astro.url.searchParams.get("message");
---

<AuthLayout title="Odzyskiwanie hasła - 10xCards">
  <Stack direction="vertical" spacing="lg">
    <!-- Error Message -->
    {
      error && (
        <div class="flex items-start gap-3 p-4 bg-[hsl(var(--apple-red))]/10 border border-[hsl(var(--apple-red))]/20 rounded-[var(--apple-radius-medium)]">
          <AlertCircle className="w-5 h-5 text-[hsl(var(--apple-red))] flex-shrink-0 mt-0.5" />
          <div>
            <Body className="text-[hsl(var(--apple-red))] font-medium">
              {error === "confirmation_failed" && "Link resetowania hasła jest nieprawidłowy lub wygasł"}
              {error === "unexpected" && "Wystąpił nieoczekiwany błąd"}
            </Body>
            {errorMessage && (
              <Body className="text-[hsl(var(--apple-red))] text-sm mt-1">{decodeURIComponent(errorMessage)}</Body>
            )}
          </div>
        </div>
      )
    }

    <!-- Header -->
    <div class="text-center">
      <Stack direction="vertical" spacing="sm" align="center">
        <div
          class="w-14 h-14 flex items-center justify-center rounded-[var(--apple-radius-large)] bg-[hsl(var(--apple-orange))]/10"
        >
          <KeyRound className="w-7 h-7 text-[hsl(var(--apple-orange))]" />
        </div>
        <Title1 className="text-[hsl(var(--apple-label))] text-3xl sm:text-4xl">Odzyskaj hasło</Title1>
        <Body className="text-[hsl(var(--apple-label-secondary))]">
          Nie pamiętasz hasła? Pomożemy Ci je zresetować.
        </Body>
      </Stack>
    </div>

    <!-- Forgot Password Form Card -->
    <Card elevation="md" padding="xl" variant="grouped">
      <CardContent>
        <ForgotPasswordForm client:load />
      </CardContent>
    </Card>
  </Stack>
</AuthLayout>
